<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JCU Gym System</title>
  <link rel="stylesheet" href="css/booking_styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>JCU Gym System</h1>
      <a href="index.html">
        <img src="image/jcu_logo.png" alt="JCU Logo"/>
      </a>
    </header>

    <nav class="nav_user">
      <ul class="menu">
            <li class="menu-choice"><a href="online_registration.html">Online Registration</a></li>
            <li class="menu-choice"><a href="session_booking.html">Session Booking</a></li> 
            <li class="menu-choice"><a href="material.html">Material</a></li>
            <li class="menu-choice"><a href="profile.html">Profile</a></li>
      </ul>
    </nav>

    <hr class="divider" />

    <main>
      <section>
        <h2>My Previous Bookings</h2>
        <table>
          <thead>
            <tr>
              <th>Booking Reference</th>
              <th>User Name</th>
              <th>Booking Date</th>
              <th>Booking Time</th>
              <th>Booked On</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="bookingTableBody"></tbody>
        </table>
        <div class="pagination">
          <button onclick="prevPage()">Back</button>
          <span id="pageInfo">Page 1</span>
          <button onclick="nextPage()">Next</button>
        </div>
      </section>

      <hr class="divider" />

      <section>
        <h2>Booking Details</h2>
        <form id="bookingForm">
          <div class="booking-flex">
            <div class="date-column">
              <h3>Pick a Date:</h3>
              <div id="dateOptions" class="grid-options date-grid"></div>
            </div>
            <div class="time-column">
              <h3>Pick Timing:</h3>
              <div id="timeOptions" class="grid-options time-grid">
                <!-- Time slot labels -->
              </div>
            </div>
          </div>
          <button type="button" onclick="submitBooking()">Submit Booking</button>
        </form>
      </section>
    </main>

    <hr class="divider" />

    <footer>
      <div class="contact_info">
        <p>Email: <a href="mailto:jcu.edu.sg">jcu.edu.sg</a></p>
        <p>Phone: <a href="tel:12345678">12345678</a></p>
        <p>Fax: 4779 1244</p>
        <p>Address: 149 Sims Drive Singapore 387380</p>
        <p>&copy; Copyright 2022. ALL Rights Reserved.</p>
      </div>
    </footer>
  </div>

  <script>
    const dateContainer = document.getElementById('dateOptions');
    const today = new Date();
    let count = 0, i = 1;
    while (count < 6) {
      const tempDate = new Date();
      tempDate.setDate(today.getDate() + i);
      if (tempDate.getDay() !== 0) {
        const dateStr = tempDate.toISOString().split('T')[0];
        const weekday = tempDate.toLocaleDateString('en-US', { weekday: 'long' });
        dateContainer.innerHTML += `<label><input type="radio" name="date" value="${dateStr}">${dateStr} (${weekday})</label>`;
        count++;
      }
      i++;
    }

    const timeOptions = [
      "09:00 - 11:00", "10:00 - 12:00", "11:00 - 13:00",
      "12:00 - 14:00", "13:00 - 15:00", "14:00 - 16:00",
      "15:00 - 17:00", "16:00 - 18:00", "17:00 - 19:00"
    ];
    const timeContainer = document.getElementById('timeOptions');
    timeOptions.forEach(t => {
      timeContainer.innerHTML += `<label><input type="radio" name="time" value="${t}">${t}</label>`;
    });

    let bookings = JSON.parse(localStorage.getItem('gymBookings')) || [];
    let currentPage = 1;
    const rowsPerPage = 4;

    function renderTable() {
      const tableBody = document.getElementById('bookingTableBody');
      tableBody.innerHTML = "";
      const start = (currentPage - 1) * rowsPerPage;
      const pageData = bookings.slice(start, start + rowsPerPage);

      pageData.forEach(b => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${b.ref}</td>
          <td>${b.user}</td>
          <td>${b.date}</td>
          <td>${b.time}</td>
          <td>${b.bookedOn}</td>
          <td><span class="delete-link" onclick="confirmDelete('${b.ref}')">üóëÔ∏è</span></td>
        `;
        tableBody.appendChild(row);
      });

      document.getElementById('pageInfo').textContent = `Page ${currentPage}`;
      localStorage.setItem('gymBookings', JSON.stringify(bookings));
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(bookings.length / rowsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderTable();
      }
    }

    function submitBooking() {
      const selectedDate = document.querySelector('input[name="date"]:checked');
      const selectedTime = document.querySelector('input[name="time"]:checked');

      if (!selectedDate || !selectedTime) {
        alert("Please select both date and time.");
        return;
      }

      const now = new Date();
      const ref = `GYM${now.getFullYear()}${Math.floor(Math.random() * 1000000).toString().padStart(6, '0')}`;
      const newBooking = {
        ref,
        user: "Xirui Huang",
        date: selectedDate.value,
        time: selectedTime.value,
        bookedOn: new Date(now.getTime() + 8 * 60 * 60 * 1000).toISOString().slice(0, 19).replace('T', ' ')
      };

      bookings.push(newBooking);
      currentPage = Math.ceil(bookings.length / rowsPerPage);
      renderTable();
      document.getElementById("bookingForm").reset();
    }

    function confirmDelete(ref) {
      if (confirm("Are you sure you want to delete this booking?")) {
        bookings = bookings.filter(b => b.ref !== ref);
        renderTable();
      }
    }

    // ÂàùÂßãÊ∏≤Êüì
    renderTable();
  </script>
</body>
</html>
