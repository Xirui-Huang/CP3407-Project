<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCU Gym System - Login</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>JCU Gym System</h1>
        </header>

        <hr class="divider" width="1500" color="black" size="3">

        <main>
            <section class="form-section">
                <h2>Staff Login</h2>
                <form id="loginForm" onsubmit="return handleLogin(event)">
                    <label>Name &amp; Staff ID:
                        <input type="text" id="name_staff_id" name="name_staff_id" required>
                    </label><br><br>

                    <label>Password:
                        <input type="password" id="password" name="password" required>
                    </label><br><br>

                    <button type="submit">Login</button>
                    <button type="button" onclick="window.location.href='online_registration.html'">Register</button>
                </form>
            </section>
        </main>

        <hr class="divider" width="1500" color="black" size="3">

        <footer>
            <div class="contact_info">
                <p>Email: <a href="mailto:jcu.edu.sg">jcu.edu.sg</a></p>
                <p>Phone: <a href="tel:12345678">12345678</a></p>
                <p>Fax: 4779 1244</p>
                <p>Address: 149 Sims Drive Singapore 387380</p>
                <p>&copy; Copyright 2022. ALL Rights Reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        function handleLogin(event) {
            event.preventDefault();

            const name_staff_id = document.getElementById('name_staff_id').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!name_staff_id || !password) {
                alert("Please enter both Staff ID and Password.");
                return;
            }

            fetch('/login_staff', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ name_staff_id, password }).toString()
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    localStorage.setItem('name_staff_id', name_staff_id); // 存登录状态
                    window.location.href = 'session_booking.html';
                } else if (data.status === 'wrong_password') {
                    alert('Incorrect password. Please try again.');
                } else if (data.status === 'not_found') {
                    if (confirm('Account not found. Do you want to register now?')) {
                        window.location.href = 'online_registration.html';
                    }
                } else {
                    alert('An error occurred. Please try again.');
                }
            })
            .catch(err => {
                console.error(err);
                alert('Login failed due to a server error.');
            });
        }
    </script>
</body>
</html>
